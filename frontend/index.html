<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" integrity="sha384-mkQ3/7FUtcGyoppY6bz/PORYoGqOl7/aSUMn2ymDOJcapfS6PHqxhRTMh1RR0Q6+" crossorigin="anonymous"></script>
    <style> h1 { text-align: center; } </style>
</head>
<body>
    <h1 class="display-3">Giotto Line</h1>

    <!-- VueJS App here the app component will ve served -->
    <div id="app" class="container-md">
        <table id="equipment-table" class="table table-hover">
            <tr>
                <th>Equipment</th>
                <th>Status</th>
            </tr>
            <!-- Creates a tr (table row) for each one of the values in the list ('rows')-->
            <tr v-for="row in rows" v-bind:class="{'table-success': (row.status==='Running'),'table-danger':(row.status!=='Running')}">
                <td>{{ row.equipment }}</td>
                <td>{{ row.status }}</td>
            </tr>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script>
        const socket = io('http://localhost:8000');
        const {createApp, ref, provide, watch} = Vue;
        
        // Create the equipmentList as an empty Array
        let equipmentList = ref([]);

        // Initialize the VueJS App component
        const app = createApp({
            setup(){
                const rows  = ref(equipmentList);
                
                // Sends the equipmenList to the app component
                provide('equipmentList', equipmentList);
                
                // Watches the equipmentList for changes (updates, etc)
                watch(equipmentList, (newValue) => {
                    rows.value = newValue;
                });
                return { rows }
            }
        });
        
        // Print in console the errors
        app.config.errorHandler = (err) => {console.error(err)};
        
        // Mount the app into the div id#app
        app.mount('#app');
        
        // Update on new data
        socket.on('update', (data) => {
            equipmentList.value = data;
            // console.log(equipmentList.value);
        });
    </script>
</body>
</html>